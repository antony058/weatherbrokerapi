# Weather Broker server

Серверная часть приложения "Погодный брокер".

Записанное в JMS-topic клиентской частью приложения сообщение, ловится 
зарегистрированным JMS-listener'ом. После получения сообщения, оно преобразовывается 
к необходимому представлению(view) погоды и отправляется в базу данных, если город
из сообщения в ней существует.

Приложение имеет API к данным о погоде.

Существует возможность добавлять погоду для городов без использования JMS.
Для этого необходимо добавить *.txt или *.json файл с данными о погоде в соответствующую
директорию:

`weather-files` - для *.txt файлов
  
`weather-json-files` - для *.json файлов

**Формат файла для добавления погоды**

`*.txt`

Для текстового файла считается, что на каждой новой строке располагается новая
запись о погоде. Формат _ГОРОД,ДАТА,ТЕМПЕРАТУРА,ОПИСАНИЕ_. Пример для
добавления погоды двух городов:

`Пенза, 01-06-2018, 23, Тепло
Москва, 02-06-2018, 29, Жарко`

`*.json`

Для json-файла формат следующий:

`
[{
	"city": "Пенза",
	"date": "10-10-2018",
	"temp": "23",
	"text": "Солнечно"
}]
`

Ограничений на добавляемое количество погоды нет, **но их запись в базу данных 
произойдет только при накоплении заданного количества**, которое определяется в
WeatherHandler.class полем WEATHER_VIES_MAX_SIZE. По умолчанию это значение равно 2.

#
**Деплой и запуск тестов** 

Приложение собирается с помощью Apache Maven.

Для деплоя приложения на сервер используется плагин `wildfly-maven-plugin`.
  Деплой выполняется командой `mvn wildfly:deploy`; перед развертыванием
  приложения на сервере выполнятся тесты.

Для запуска тестов _отдельно_ необходимо выполнить команду `mvn verify -Ptest`
  
  **Выход в браузер**
 
 После развертывания приложения на сервере, оно будет доступно по адресу
  `127.0.0.1:8888/weatherapi`.
  
  **API**
  
  **1**) Для получения списка городов, записанных в базе данных:
  
  `127.0.0.1:8080/weatherapi/city/list/{city}` - где `{city}` 
  является подстрокой названия города.
  
  Формат ответа - `JSON`
  
  **2**) Для получения погоды конкретного города, хранящейся в базе данных:
  
  `127.0.0.1:8080/weatherapi/weather/{city}` - где `{city}`
  является полным названием города.
  
  Формат ответа - `JSON`